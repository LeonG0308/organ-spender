<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organ-Spender.de - Admin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        /* Eingebettetes CSS für Unabhängigkeit von externen Dateien */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background-color: #0066cc;
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .hidden {
            display: none;
        }

        h1, h2, h3 {
            margin-bottom: 1rem;
        }

        p {
            margin-bottom: 1rem;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: background-color 0.3s, transform 0.1s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }
        
        .login-container {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .error {
            color: #f44336;
            font-size: 0.9rem;
        }

        .admin-dashboard {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-container {
            flex: 1;
            min-width: 300px;
            height: 400px;
        }

        .stats-summary {
            flex: 0 0 250px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 1.5rem;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .stat-label {
            font-weight: bold;
        }

        .stat-value {
            font-size: 1.2rem;
            color: #0066cc;
        }

        .admin-controls {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-refresh {
            background-color: #0066cc;
            color: white;
        }

        .btn-reset {
            background-color: #f44336;
            color: white;
        }

        .btn-refresh:hover {
            background-color: #0052a3;
        }

        .btn-reset:hover {
            background-color: #d32f2f;
        }

        .reset-confirm {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
        }

        .reset-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn-danger {
            background-color: #f44336;
            color: white;
        }

        .btn-cancel {
            background-color: #f1f1f1;
            color: #333;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-cancel:hover {
            background-color: #e5e5e5;
        }

        @media (max-width: 768px) {
            .stats-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Organ-Spender.de - Administrations-Bereich</h1>
    </div>
    
    <div class="main-content">
        <div id="login-container" class="login-container">
            <h2>Admin Login</h2>
            <div class="login-form">
                <input type="password" id="password" placeholder="Passwort eingeben">
                <button id="login-btn">Einloggen</button>
                <p id="login-error" class="error hidden">Falsches Passwort. Bitte versuchen Sie es erneut.</p>
            </div>
        </div>
        
        <div id="admin-dashboard" class="admin-dashboard hidden">
            <h2>Cookie-Statistiken</h2>
            
            <div class="stats-container">
                <div class="chart-container">
                    <canvas id="cookie-chart"></canvas>
                </div>
                
                <div class="stats-summary">
                    <div class="stat-item">
                        <span class="stat-label">Akzeptiert:</span>
                        <span id="accept-count" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Abgelehnt:</span>
                        <span id="reject-count" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Gesamt:</span>
                        <span id="total-count" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Akzeptanzrate:</span>
                        <span id="accept-rate" class="stat-value">0%</span>
                    </div>
                </div>
            </div>
            
            <div class="admin-controls">
                <button id="refresh-btn" class="btn-refresh">Daten aktualisieren</button>
                <button id="reset-btn" class="btn-reset">Alle Daten zurücksetzen</button>
            </div>
            
            <div id="reset-confirm" class="reset-confirm hidden">
                <p>Sind Sie sicher, dass Sie alle Daten zurücksetzen möchten? Diese Aktion kann nicht rückgängig gemacht werden.</p>
                <div class="reset-buttons">
                    <button id="confirm-reset" class="btn-danger">Ja, zurücksetzen</button>
                    <button id="cancel-reset" class="btn-cancel">Abbrechen</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Warte bis die Seite vollständig geladen ist
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Seite geladen"); // Debug-Meldung
            
            // Konstanten und Variablen
            const correctPassword = "Umfrage";
            let cookieChart = null;
            
            // DOM-Elemente
            const loginBtn = document.getElementById("login-btn");
            const passwordField = document.getElementById("password");
            const loginError = document.getElementById("login-error");
            const loginContainer = document.getElementById("login-container");
            const adminDashboard = document.getElementById("admin-dashboard");
            const refreshBtn = document.getElementById("refresh-btn");
            const resetBtn = document.getElementById("reset-btn");
            const resetConfirm = document.getElementById("reset-confirm");
            const confirmResetBtn = document.getElementById("confirm-reset");
            const cancelResetBtn = document.getElementById("cancel-reset");
            
            // Login-Funktion
            function login() {
                console.log("Login-Funktion aufgerufen"); // Debug-Meldung
                const password = passwordField.value;
                
                if (password === correctPassword) {
                    console.log("Passwort korrekt"); // Debug-Meldung
                    loginContainer.style.display = "none";
                    adminDashboard.classList.remove("hidden");
                    loadData();
                    
                    // Automatische Aktualisierung
                    setInterval(loadData, 5000);
                } else {
                    console.log("Passwort falsch"); // Debug-Meldung
                    loginError.classList.remove("hidden");
                }
            }
            
            // Event-Listener für Login-Button
            loginBtn.addEventListener("click", function() {
                console.log("Login-Button geklickt"); // Debug-Meldung
                login();
            });
            
            // Event-Listener für Enter-Taste im Passwort-Feld
            passwordField.addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    console.log("Enter-Taste gedrückt"); // Debug-Meldung
                    login();
                }
            });
            
            // Helper-Funktion für localStorage
            function getStoredData(key, defaultValue = []) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            }
            
            // Diagramm initialisieren
            function initChart(acceptCount, rejectCount) {
                console.log("Chart wird initialisiert"); // Debug-Meldung
                const ctx = document.getElementById('cookie-chart').getContext('2d');
                
                // Zerstöre vorhandenes Diagramm
                if (cookieChart !== null) {
                    cookieChart.destroy();
                }
                
                cookieChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Cookies akzeptiert', 'Cookies abgelehnt'],
                        datasets: [{
                            label: 'Anzahl der Teilnehmer',
                            data: [acceptCount, rejectCount],
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(255, 99, 132, 0.8)'
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Cookie-Entscheidungen der Teilnehmer',
                                font: {
                                    size: 16
                                }
                            }
                        }
                    }
                });
            }
            
            // Daten laden
            function loadData() {
                console.log("Daten werden geladen"); // Debug-Meldung
                const cookieChoices = getStoredData('cookieChoices', []);
                
                // Zähle Akzeptiert und Abgelehnt
                const acceptCount = cookieChoices.filter(choice => choice.choice === 'accept').length;
                const rejectCount = cookieChoices.filter(choice => choice.choice === 'reject').length;
                const totalCount = acceptCount + rejectCount;
                
                console.log(`Daten geladen: ${acceptCount} akzeptiert, ${rejectCount} abgelehnt`); // Debug-Meldung
                
                // Aktualisiere Diagramm
                initChart(acceptCount, rejectCount);
                
                // Aktualisiere Statistik-Zusammenfassung
                document.getElementById("accept-count").textContent = acceptCount;
                document.getElementById("reject-count").textContent = rejectCount;
                document.getElementById("total-count").textContent = totalCount;
                
                // Berechne und aktualisiere die Akzeptanzrate
                const acceptRate = totalCount > 0 ? 
                    Math.round((acceptCount / totalCount) * 100) : 0;
                document.getElementById("accept-rate").textContent = acceptRate + "%";
            }
            
            // Event-Listener für Aktualisieren-Button
            refreshBtn.addEventListener("click", function() {
                console.log("Aktualisieren-Button geklickt"); // Debug-Meldung
                loadData();
            });
            
            // Event-Listener für Zurücksetzen-Button
            resetBtn.addEventListener("click", function() {
                console.log("Zurücksetzen-Button geklickt"); // Debug-Meldung
                resetConfirm.classList.remove("hidden");
            });
            
            // Event-Listener für Abbrechen-Button beim Zurücksetzen
            cancelResetBtn.addEventListener("click", function() {
                console.log("Abbrechen-Button geklickt"); // Debug-Meldung
                resetConfirm.classList.add("hidden");
            });
            
            // Event-Listener für Bestätigen-Button beim Zurücksetzen
            confirmResetBtn.addEventListener("click", function() {
                console.log("Bestätigen-Button geklickt"); // Debug-Meldung
                // Lösche localStorage-Daten
                localStorage.removeItem('cookieChoices');
                localStorage.removeItem('surveyAnswers');
                
                resetConfirm.classList.add("hidden");
                loadData(); // Aktualisiere die Daten
            });
            
            // Manuelle Testdaten für Debugzwecke einfügen
            // Auskommentieren für Produktiveinsatz
            /*
            if (!localStorage.getItem('cookieChoices')) {
                const testData = [
                    {choice: 'accept', timestamp: new Date().toISOString()},
                    {choice: 'accept', timestamp: new Date().toISOString()},
                    {choice: 'reject', timestamp: new Date().toISOString()}
                ];
                localStorage.setItem('cookieChoices', JSON.stringify(testData));
            }
            */
        });
    </script>
</body>
</html>